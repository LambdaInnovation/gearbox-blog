---
title: 开发日志 3# - 玩家动作&战斗进度
lang: zh-cn
date: 2017-03-23 00:20:14
category: devblog
---

大家好，我是狼，这周又轮到我写devblog了……

这两周的时间我完成了战斗系统部分的大致构建，也解决了很多在之前做过的原型没解决的问题。首先看看现在的结果吧：

![](/img/devblog-3-1.gif)
![](/img/devblog-3-2.gif)

现在的战斗总算有点拳拳到肉并且流畅转换的感觉了。策划层面，我们在这两周做了很多方向性的修改，其中的大多修改都是为了保证**流畅快速**。例如，玩家的前后闪步本来是前后滚翻，但为了让玩家可以快速的接近怪物/躲避攻击，修改成了闪步；接战时添加攻击判定以快速击晕怪物，等等。

战斗部分的实现由于之前有很多相关思考，所以基本是一步到位，这里总结一下一些实现战斗过程中对体验比较重要的点。

<!--- MORE --->

## 1. 输入接受和Combo

这里主要说的是对玩家输入的处理。我们在玩家处用的是Unity的Mechanim，它是一个HFSM（多层有限状态机）结构。假如要实现一个玩家从站立-攻击的转换，最简单的只需要添加一条转换边：

> fight_idle --(按下攻击键)-> attack

这样可以工作，但它对动作游戏并不够。例如，我们闪步后是回到站立，但如果玩家在闪步快要结束的时候按下攻击，这个输入就会被**忽略**，这样的忽略是反直觉并且影响体验的（尤其是有的动作末尾是过渡帧，对玩家来说，在这几帧无法分辨是在上一个动作还是下一个）。

因此，我们应该尽可能避免输入被忽略的情况出现。目前暂时是手动在各个动画内手动的添加延迟输入处理的脚本，感觉需要一个更加自动化的解决方案，暂时还在考虑中。

接下来说说Combo。Combo的实现原理其实相当简单，用一个结构来存Combo的转换信息：

```C#
	[Serializable]
	public class StateTransition {
		public string state;
		public int startFrame;
		public int startTransitionFrame;
		public string buttonName;
	}

	[Serializable]
	public class Combo {
		public string name;
		public List<StateTransition> list;

		[NonSerialized]
		public int progress; // Current state index of combo.

		[NonSerialized]
		public bool triggeredButton = false; // Have we triggered button in current state.
	}
```

加上可视化编辑器，就可以这么编辑了：

![](/img/combo-editor.jpg)

在运行时，我们对每个combo存一个“运行进度”索引，并根据当前动作和输入对运行进度进行更新。每次动作结束，如果玩家按下了对应的按键，就更新combo进度，并转换动作，这样就实现了combo。

## 2. 反馈感优化

我重点考察了几个方面，来进行游戏反馈感觉的优化：

### 时停

在玩家攻击到怪物的时候，会给一个短暂的时停，这个时停和当前攻击的'威力'成正相关。这样就会给一种【真的打到肉上了】的感觉，也在润色上体现出各个攻击的区别。

### 位移和击退

在Gearbox里，我们把玩家在战斗中位移的控制作为一个非常核心的玩点。玩家在攻击时会随步伐主动前进，被攻击时则会有向后的击退。

### 控制感

老版本的原型中，我们把有的动画设置的很长，从而造成了一种滞空感和迟滞感。对于那些会剥夺玩家操作的动作（e.g. 攻击，跳跃，爬墙），我们应该考虑尽可能减少它们的占用时间——即便这和现实状况不符。如果玩家被剥夺操作的时间过长，很容易带来心流的打断。

# Summing Up

总而言之，ACT的战斗是一个即时性非常强的东西。要做到流畅爽快，必须在反馈方面下大工夫，提高玩家的操作感。

接下来我们应该会尝试加入更多的场景交互，以及完成一些具体的场景。这些内容和怪物结合起来，我们离一个实际可玩的关卡也更近了一步。敬请期待！
