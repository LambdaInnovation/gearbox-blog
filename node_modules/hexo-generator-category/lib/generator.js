'use strict';

var pagination = require('hexo-pagination');

module.exports = function(locals){
  var config = this.config;
  var perPage = config.category_generator.per_page;
  var langs = config.language;
  var paginationDir = config.pagination_dir || 'page';

  return locals.categories.reduce(function(result, category){
    if (!category.length) return result;

    var t = result;
    langs.forEach(function(lang) {
      var posts = category.posts
                    .filter(function(x) { return x.lang == lang })
                    .sort('-date');
      var data = pagination(lang + '/' + category.path, posts, {
        perPage: perPage,
        layout: ['category', 'archive', 'index'],
        format: paginationDir + '/%d/',
        data: {
          category: category.name
        }
      });
      t = t.concat(data);
    });

    return t;
  }, []);
};